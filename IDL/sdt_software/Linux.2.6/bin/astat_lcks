#!/usr/bin/ksh
#
# KSH SCRIPT:	astat	
#	
# PURPOSE:	Display information about the archive system.
#
# INPUTS:       none
#
#

# Environment setup

. /disks/fast/software/config/archive_config

# Cleanup function

function quitearly {
	if [ -a /tmp/astattmp ] ; then
		rm /tmp/astattmp
	fi
	print
	exit 0
}

# Must run from FINET machine

host=$(uname -n)
if [[ "$host" != "$FINETPRIMARY" && $host != "$FINETBACKUP" ]] ; then
    print "Must run from a FINET machine."
    exit 1
fi

# Set trap for premature exit

trap quitearly EXIT

# Report Header

printf '\n\t\t  >>>>> ARCHIVE SYSTEM STATUS REPORT <<<<<\n\t\t\t%s\n\n' "`date`"
# Lockfiles
#
printf "\nLOCKFILES\n============================================================\n"
printf "%-30s\t%-12s\t%s\n" "Lock" "User" "Date"
printf "------------------------------------------------------------\n"

ls -l /var/tmp /tmp/holdup* 2>/dev/null |
awk '/holdup/ || /lock/ && $3 !~ /root/ {
	if (substr($9,1,4) == "/tmp") {
	    hold = substr($9,6,30) ; 
	    printf("%-30s\t%-12s\t%s %s %s\n", hold,$3,$6,$7,$8) ;
	}
	else printf("%-30s\t%-12s\t%s %s %s\n", $9,$3,$6,$7,$8) }' -

rsh $DANETHOST ls -l /var/tmp |
awk '/lock/ && $3 !~ /root/ {
	printf("%-30s\t%-12s\t%s %s %s\n", $9,$3,$6,$7,$8) }' -

exit 0
