#! /usr/bin/ksh
#
# KSH SCRIPT
#
# doy2date
#
# PURPOSE:
#
# Converts a 4-digit year and day-of-year to standard date format.
# yyyy ddd   -->   yyyy/mm/dd
#
# By J. Rauchleiba
# May 26 1998
#

# Usage

if [[ ${#} != "2" ]] ; then
    print "Usage:  doy2date yyyy ddd"
fi

# Argument Handling

typeset -i yyyy=$1
typeset -i ddd=$2
if [[ ${#yyyy} != 4 || $ddd -gt 366 ]] ; then
    print "Arguments out of range:  yyyy=$yyyy  ddd=$ddd"
    exit 1
fi

# Check if leap year
# Set array containing number of days accumulated prior to each month

if ((yyyy%4 == 0 && (yyyy%100 != 0 || yyyy%400 == 0) )) ; then
    set -A numdays 0 31 60 91 121 152 182 213 244 274 305 335 366
else
    set -A numdays 0 31 59 90 120 151 181 212 243 273 304 334 365
fi

# Loop through months until "leftover days" less than number in following month

typeset -i month=1
typeset -i ndays dom
while ((month <= 12)) ;do
    ndays=${numdays[$((month-1))]}
    dom=$(( ddd - ndays ))
    if (( dom <= $(( ${numdays[$month]} - ndays )) )) ; then
	break
    fi
    let 'month=month+1'
done

# Output

printf "%s/%02s/%02s\n" $yyyy $month $dom


exit 0
