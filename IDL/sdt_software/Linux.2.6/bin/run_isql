#!/bin/ksh
#
#	run_isql.sh
#
#	@(#)run_isql.sh	1.1 09/29/97
#
#	Usage:
#		run_isql [-c <config>] sqlgen_prog data_file
#
#	Connects to Sybase and the FAST database, and runs sql
#	generated by program sqlgen_prog using data_file as input.
#
#	Parameters:
#	<sqlgen_prog>	name of program such as kp_sqlgen or dst_sqlgen
#			which will generate sql on sdtout.
#
#	<data_file>	input file for the sqlgen_prog.
#
#	<config>	Configuration file.  Default: fast_dbupdate.conf 
#			in FASTCONFIG, then FASTLIB
#
# ***********************************************************

# *** Temporary files
TEMPSQL=/tmp/sql$$
TEMPRES=/tmp/res$$

# *** Exit processing
finish () {
	/bin/rm -f ${TEMPSQL} ${TEMPRES}
}
trap finish EXIT

# *** Command line processing
MYNAME=$(basename $0)
CONFIG=fast_dbupdate.conf
. fast_dbenv_setup
ERR=$?
if [ ${ERR} -ne 0 ] ; then
        echo "${MYNAME}:  ${ARCH_ERROR}" 1>&2
        exit ${ERR}
fi
 

if [ "$1" = "-c" ] ; then
	shift 2
fi

# Environment

# =============================================================

eval $1 $2 > ${TEMPSQL}
ERR=$?
if [ ${ERR} = 0 ] ; then
	(do_isql ${TEMPSQL} ; echo $? > ${TEMPRES}) | \
	    grep -v 'return status' | grep -v 'Password:'
	ERR=$(cat ${TEMPRES})
	if [ ${ERR} != 0 ] ; then
	   echo "${MYNAME}:  isql error" 1>&2
	   exit ${ERR}
	fi
else
	echo "${MYNAME}:  $1 error" 1>&2
fi

# *** All done
exit ${ERR}
