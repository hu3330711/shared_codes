      FUNCTION TRARA2(MAP,IL,IB)
      DIMENSION MAP(777)
      DATA FISTEP/256./
      FNL=IL
      FNB=IB
      ITIME=0
      I2=0
    1 L2=MAP(I2+1)
      IF(MAP(I2+2).GT.IL)GO TO 2
      I1=I2
      L1=L2
      I2=I2+L2
      GO TO 1
    2 CONTINUE
      IF(L1.LT.4.AND.L2.LT.4)GO TO 50
      IF(MAP(I2+3).GT.MAP(I1+3))GO TO 10
    5 KT=I1
      I1=I2
      I2=KT
      KT=L1
      L1=L2
      L2=KT
   10 FLOG1=MAP(I1+3)
      FLL1=MAP(I1+2)
      FLOG2=MAP(I2+3)
      FLL2=MAP(I2+2)
      DFL=(FNL-FLL1)/(FLL2-FLL1)
      FKB1=0.
      FKB2=0.
      IF(L1.LT.4)GO TO 32
      DO 17 J2=4,L2
      FINCR2=MAP(I2+J2)
      IF(FKB2+FINCR2.GT.FNB)GO TO 23
      FKB2=FKB2+FINCR2
   17 FLOG2=FLOG2-FISTEP
      ITIME=ITIME+1
      IF(ITIME.EQ.1)GO TO 5
      GO TO 50
   23 IF(ITIME.EQ.1)GO TO 30
      IF(J2.EQ.4)GO TO 28
      SL2=FLOG2/FKB2
      DO 27 J1=4,L1
      FINCR1=MAP(I1+J1)
      FKB1=FKB1+FINCR1
      FLOG1=FLOG1-FISTEP
      FKBJ1=((FLOG1/FISTEP)*FINCR1+FKB1)/((FINCR1/FISTEP)*SL2+1.)
      IF(FKBJ1.LE.FKB1)GO TO 31
   27 CONTINUE
      GO TO 55
   31 IF(FKBJ1.LE.FKB2)GO TO 29
      FKB1=0.
   30 FKB2=0.
   32 J2=4
      FINCR2=MAP(I2+J2)
      FLOG2=MAP(I2+3)
      FLOG1=MAP(I1+3)
   28 FLOGM=FLOG1+(FLOG2-FLOG1)*DFL
      FKBM=0.
      FKB2=FKB2+FINCR2
      FLOG2=FLOG2-FISTEP
      SL2=FLOG2/FKB2
      IF(L1.LT.4)GO TO 35
      J1=4
      FINCR1=MAP(I1+J1)
      FKB1=FKB1+FINCR1
      FLOG1=FLOG1-FISTEP
      SL1=FLOG1/FKB1
      GO TO 15
   29 FKBM=FKBJ1+(FKB2-FKBJ1)*DFL
      FLOGM=FKBM*SL2
      FLOG2=FLOG2-FISTEP
      FKB2=FKB2+FINCR2
      SL1=FLOG1/FKB1
      SL2=FLOG2/FKB2
   15 IF(SL1.LT.SL2)GO TO 20
      FKBJ2=((FLOG2/FISTEP)*FINCR2+FKB2)/((FINCR2/FISTEP)*SL1+1.)
      FKB=FKB1+(FKBJ2-FKB1)*DFL
      FLOG=FKB*SL1
      IF(FKB.GE.FNB)GO TO 60
      FKBM=FKB
      FLOGM=FLOG
      IF (J1.GE.L1) GO TO 55
      J1=J1+1
      FINCR1=MAP(I1+J1)
      FLOG1=FLOG1-FISTEP
      FKB1=FKB1+FINCR1
      SL1=FLOG1/FKB1
      GO TO 15
   20 FKBJ1=((FLOG1/FISTEP)*FINCR1+FKB1)/((FINCR1/FISTEP)*SL2+1.)
      FKB=FKBJ1+(FKB2-FKBJ1)*DFL
      FLOG=FKB*SL2
      IF(FKB.GE.FNB)GO TO 60
      FKBM=FKB
      FLOGM=FLOG
      IF(J2.GE.L2) GO TO 55
      J2=J2+1
      FINCR2=MAP(I2+J2)
      FLOG2=FLOG2-FISTEP
      FKB2=FKB2+FINCR2
      SL2=FLOG2/FKB2
      GO TO 15
   50 TRARA2=0.
      RETURN
   35 FINCR1=0.
      SL1=-900000.
      GO TO 20
   60 IF(FKB.LT.FKBM+1.E-20)GO TO 50
      TRARA2=FLOGM+(FLOG-FLOGM)*((FNB-FKBM)/(FKB-FKBM))
      TRARA2=AMAX1(TRARA2,0.)
      RETURN
 55   TRARA2=0.
      RETURN
      END
